"use strict"; /* istanbul ignore next */var cov_2oqqgoa44p = function () {var path = "/code/cilantro/iogates-transfer/src/commands/download.ts",hash = "4b2b70c1efb91cb91c4cb3ac59e33d0abf2618ef",global = new Function('return this')(),gcv = "__coverage__",coverageData = { path: "/code/cilantro/iogates-transfer/src/commands/download.ts", statementMap: { "0": { start: { line: 2, column: 0 }, end: { line: 2, column: 62 } }, "1": { start: { line: 3, column: 16 }, end: { line: 3, column: 39 } }, "2": { start: { line: 4, column: 18 }, end: { line: 4, column: 43 } }, "3": { start: { line: 5, column: 21 }, end: { line: 5, column: 49 } }, "4": { start: { line: 6, column: 20 }, end: { line: 6, column: 47 } }, "5": { start: { line: 8, column: 12 }, end: { line: 8, column: 23 } }, "6": { start: { line: 11, column: 24 }, end: { line: 11, column: 32 } }, "7": { start: { line: 12, column: 21 }, end: { line: 12, column: 29 } }, "8": { start: { line: 13, column: 23 }, end: { line: 13, column: 52 } }, "9": { start: { line: 14, column: 19 }, end: { line: 14, column: 42 } }, "10": { start: { line: 15, column: 22 }, end: { line: 15, column: 60 } }, "11": { start: { line: 17, column: 4 }, end: { line: 17, column: 30 } }, "12": { start: { line: 18, column: 4 }, end: { line: 57, column: 7 } }, "13": { start: { line: 21, column: 8 }, end: { line: 21, column: 59 } }, "14": { start: { line: 24, column: 8 }, end: { line: 24, column: 67 } }, "15": { start: { line: 25, column: 8 }, end: { line: 27, column: 9 } }, "16": { start: { line: 28, column: 8 }, end: { line: 28, column: 49 } }, "17": { start: { line: 31, column: 8 }, end: { line: 31, column: 39 } }, "18": { start: { line: 32, column: 8 }, end: { line: 32, column: 28 } }, "19": { start: { line: 35, column: 8 }, end: { line: 35, column: 27 } }, "20": { start: { line: 36, column: 8 }, end: { line: 36, column: 36 } }, "21": { start: { line: 37, column: 8 }, end: { line: 37, column: 34 } }, "22": { start: { line: 40, column: 8 }, end: { line: 40, column: 40 } }, "23": { start: { line: 42, column: 8 }, end: { line: 42, column: 69 } }, "24": { start: { line: 45, column: 8 }, end: { line: 45, column: 50 } }, "25": { start: { line: 46, column: 8 }, end: { line: 48, column: 11 } }, "26": { start: { line: 47, column: 12 }, end: { line: 47, column: 102 } }, "27": { start: { line: 49, column: 8 }, end: { line: 49, column: 63 } }, "28": { start: { line: 52, column: 8 }, end: { line: 52, column: 36 } }, "29": { start: { line: 53, column: 8 }, end: { line: 53, column: 26 } }, "30": { start: { line: 56, column: 8 }, end: { line: 56, column: 23 } }, "31": { start: { line: 59, column: 0 }, end: { line: 59, column: 40 } } }, fnMap: { "0": { name: "downloadComand", decl: { start: { line: 10, column: 9 }, end: { line: 10, column: 23 } }, loc: { start: { line: 10, column: 36 }, end: { line: 58, column: 1 } }, line: 10 }, "1": { name: "(anonymous_1)", decl: { start: { line: 20, column: 14 }, end: { line: 20, column: 15 } }, loc: { start: { line: 20, column: 20 }, end: { line: 22, column: 5 } }, line: 20 }, "2": { name: "(anonymous_2)", decl: { start: { line: 23, column: 14 }, end: { line: 23, column: 15 } }, loc: { start: { line: 23, column: 25 }, end: { line: 29, column: 5 } }, line: 23 }, "3": { name: "(anonymous_3)", decl: { start: { line: 30, column: 14 }, end: { line: 30, column: 15 } }, loc: { start: { line: 30, column: 25 }, end: { line: 33, column: 5 } }, line: 30 }, "4": { name: "(anonymous_4)", decl: { start: { line: 34, column: 14 }, end: { line: 34, column: 15 } }, loc: { start: { line: 34, column: 25 }, end: { line: 38, column: 5 } }, line: 34 }, "5": { name: "(anonymous_5)", decl: { start: { line: 39, column: 14 }, end: { line: 39, column: 15 } }, loc: { start: { line: 39, column: 28 }, end: { line: 43, column: 5 } }, line: 39 }, "6": { name: "(anonymous_6)", decl: { start: { line: 44, column: 14 }, end: { line: 44, column: 15 } }, loc: { start: { line: 44, column: 29 }, end: { line: 50, column: 5 } }, line: 44 }, "7": { name: "(anonymous_7)", decl: { start: { line: 46, column: 26 }, end: { line: 46, column: 27 } }, loc: { start: { line: 46, column: 40 }, end: { line: 48, column: 9 } }, line: 46 }, "8": { name: "(anonymous_8)", decl: { start: { line: 51, column: 14 }, end: { line: 51, column: 15 } }, loc: { start: { line: 51, column: 20 }, end: { line: 54, column: 5 } }, line: 51 }, "9": { name: "(anonymous_9)", decl: { start: { line: 55, column: 15 }, end: { line: 55, column: 16 } }, loc: { start: { line: 55, column: 22 }, end: { line: 57, column: 5 } }, line: 55 } }, branchMap: { "0": { loc: { start: { line: 25, column: 8 }, end: { line: 27, column: 9 } }, type: "if", locations: [{ start: { line: 25, column: 8 }, end: { line: 27, column: 9 } }, { start: { line: 25, column: 8 }, end: { line: 27, column: 9 } }], line: 25 } }, s: { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0, "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0, "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0, "24": 0, "25": 0, "26": 0, "27": 0, "28": 0, "29": 0, "30": 0, "31": 0 }, f: { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0, "7": 0, "8": 0, "9": 0 }, b: { "0": [0, 0] }, _coverageSchema: "332fd63041d2c1bcb487cc26dd0d5f7d97098a6c" },coverage = global[gcv] || (global[gcv] = {});if (coverage[path] && coverage[path].hash === hash) {return coverage[path];}coverageData.hash = hash;return coverage[path] = coverageData;}();++cov_2oqqgoa44p.s[0];
Object.defineProperty(exports, "__esModule", { value: true });
const types_1 = /* istanbul ignore next */(++cov_2oqqgoa44p.s[1], require("../lib/types"));
const iogates_1 = /* istanbul ignore next */(++cov_2oqqgoa44p.s[2], require("../lib/iogates"));
const downloader_1 = /* istanbul ignore next */(++cov_2oqqgoa44p.s[3], require("../lib/downloader"));
const directory_1 = /* istanbul ignore next */(++cov_2oqqgoa44p.s[4], require("../lib/directory"));
// import debug from 'debug';
const log = /* istanbul ignore next */(++cov_2oqqgoa44p.s[5], console.log);
// const log = debug('io:command:download');
function downloadComand(args, done) {/* istanbul ignore next */++cov_2oqqgoa44p.f[0];
    const destination = /* istanbul ignore next */(++cov_2oqqgoa44p.s[6], args.dir);
    const shareUrl = /* istanbul ignore next */(++cov_2oqqgoa44p.s[7], args.url);
    const downloader = /* istanbul ignore next */(++cov_2oqqgoa44p.s[8], new downloader_1.Downloader());
    const ioGate = /* istanbul ignore next */(++cov_2oqqgoa44p.s[9], new iogates_1.IOGates());
    const directory = /* istanbul ignore next */(++cov_2oqqgoa44p.s[10], new directory_1.Directory(destination));
    let outerShare; /* istanbul ignore next */++cov_2oqqgoa44p.s[11];
    log('executing download'); /* istanbul ignore next */++cov_2oqqgoa44p.s[12];
    directory.
    create().
    then(() => {/* istanbul ignore next */++cov_2oqqgoa44p.f[1];++cov_2oqqgoa44p.s[13];
        return types_1.Share.LOOKUP(shareUrl, destination);
    }).
    then(share => {/* istanbul ignore next */++cov_2oqqgoa44p.f[2];++cov_2oqqgoa44p.s[14];
        log('share created: ', share.id, '(', share.complete, ')'); /* istanbul ignore next */++cov_2oqqgoa44p.s[15];
        if (share.complete) {
            // completed share.
            /* istanbul ignore next */++cov_2oqqgoa44p.b[0][0];} else /* istanbul ignore next */{++cov_2oqqgoa44p.b[0][1];}++cov_2oqqgoa44p.s[16];
        return ioGate.authenticateFromUrl(share);
    }).
    then(share => {/* istanbul ignore next */++cov_2oqqgoa44p.f[3];++cov_2oqqgoa44p.s[17];
        log('share saved after auth.'); /* istanbul ignore next */++cov_2oqqgoa44p.s[18];
        return share.save(); // updated w/ token and stuff.
    }).
    then(share => {/* istanbul ignore next */++cov_2oqqgoa44p.f[4];++cov_2oqqgoa44p.s[19];
        outerShare = share; /* istanbul ignore next */++cov_2oqqgoa44p.s[20];
        log('going to read files.'); /* istanbul ignore next */++cov_2oqqgoa44p.s[21];
        return ioGate.readFiles();
    }).
    then(response => {/* istanbul ignore next */++cov_2oqqgoa44p.f[5];++cov_2oqqgoa44p.s[22];
        log('going to download files.');
        // check which files to download.
        /* istanbul ignore next */++cov_2oqqgoa44p.s[23];return downloader.downloadFiles(response.files, destination);
    }).
    then(responses => {/* istanbul ignore next */++cov_2oqqgoa44p.f[6];++cov_2oqqgoa44p.s[24];
        log('Uploaded files: ', responses.length); /* istanbul ignore next */++cov_2oqqgoa44p.s[25];
        responses.forEach(response => {/* istanbul ignore next */++cov_2oqqgoa44p.f[7];++cov_2oqqgoa44p.s[26];
            console.log('Success(', response.success, '): ', response.file.name, '->', response.dest);
        }); /* istanbul ignore next */++cov_2oqqgoa44p.s[27];
        return types_1.File.STORE_FILES(responses, outerShare);
    }).
    then(() => {/* istanbul ignore next */++cov_2oqqgoa44p.f[8];++cov_2oqqgoa44p.s[28];
        console.log('done saving.'); /* istanbul ignore next */++cov_2oqqgoa44p.s[29];
        return done(null);
    }).
    catch(e => {/* istanbul ignore next */++cov_2oqqgoa44p.f[9];++cov_2oqqgoa44p.s[30];
        console.log(e);
    });
} /* istanbul ignore next */++cov_2oqqgoa44p.s[31];
exports.downloadComand = downloadComand;
//# sourceMappingURL=download.js.map